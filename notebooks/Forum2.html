
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Forum 2 - Hello Data, Meet Weather &#8212; My Jupyter Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=35598371" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/Forum2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Forum 2 Overview" href="../tutorials/forum2-overview.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">My Jupyter Book</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    SSP Data Forums
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Details</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../details/ssp-overview.html">üåê SSP Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../details/organizing-team.html">üßë‚Äçü§ù‚Äçüßë Organizing Team</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Preparation &amp; Technical Details</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../prep/who-should-attend.html">üôã Who Should Attend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/what-to-expect.html">üìÖ What to Expect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/what-to-bring.html">üß© What to Bring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/technical-notes.html">‚öôÔ∏è Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prep/additional-resources.html">üìö Additional Resources</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../tutorials/forum1-overview.html">Forum 1 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/forum2-overview.html">Forum 2 Overview</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Forum 2 - Hello Data, Meet Weather</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/Forum2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Forum 2 - Hello Data, Meet Weather</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goals">Goals:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-this">Why do this?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-and-setup-imports">Introduction and Setup (Imports)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-search-for-datasets">Step 1: Search for Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-search-for-10-results">Simple search for 10 results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-with-more-than-10-results">Search with more than 10 results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subsetting-our-results">Subsetting Our Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-get-dataset-metadata-and-files">Step 2: Get Dataset Metadata and Files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-metadata-for-a-single-dataset">Getting metadata for a single dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#file-level-metadata">File level metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-dataset-metadata">Full dataset metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-the-results-from-json">Transform the results from JSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-metadata-for-multiple-datasets">Getting metadata for multiple datasets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-download-a-file">Step 3: Download a File</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-the-dataset">Examine the dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#variable-names">Variable names</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#unfortunately-nws-region-only-has-four-regions-nonetheless-it-might-be-useful-at-some-point">Unfortunately, ‚Äúnws_region‚Äù only has four regions.  Nonetheless, it might be useful at some point.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-merge-with-weather-data">Step 4: Merge with Weather Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iowa-mesonet">Iowa Mesonet</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-visualizations-of-the-watches-and-warnings">Quick Visualizations of the Watches and Warnings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-wwwas-by-survey-reponses">Visualizing WWWAs by Survey Reponses</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#going-further">Going further</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chi-square">Chi-Square</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">Logistic Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-logistic-regression">Ordinal Logistic Regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#but-did-wwas-really-affect-risk-perception">But Did WWAs <em>Really</em> Affect Risk Perception?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-possible-interpretation">A possible interpretation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapping-up">Wrapping Up</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-forward">Moving Forward</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="forum-2-hello-data-meet-weather">
<h1>Forum 2 - Hello Data, Meet Weather<a class="headerlink" href="#forum-2-hello-data-meet-weather" title="Link to this heading">#</a></h1>
<p>Author: Jonathon Mote, PhD - Weather Program Office
September 2025</p>
<p>This tutorial is designed for social scientists who want to explore how their own data might begin to interface with weather and hazard datasets.  The tutorial will provide a quick overview of Jupyter notebooks and tools, some geospatial tools, and API access for environmental and weather data.</p>
<section id="goals">
<h2>Goals:<a class="headerlink" href="#goals" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Overview of API access</p></li>
<li><p>Load and explore a sample of the Extreme Weather and Society Survey data</p></li>
<li><p>Bring in a sample weather dataset (e.g., watches/warnings/advisories from NWS)</p></li>
<li><p>Perform a simple merge</p></li>
<li><p>Visualize a relationship between survey responses and weather</p></li>
</ol>
<p>Note: Ensure that the datasets are open access, or you have an API key for restricted access.  For this example, the datasets in this notebook do not require an API key.</p>
</section>
<section id="why-do-this">
<h2>Why do this?<a class="headerlink" href="#why-do-this" title="Link to this heading">#</a></h2>
<p>In general, the integration of weather and hazard data, and addressing both temporal and spatial resolutions, might allow for a deeper understanding of how people perceive, interpret, and respond to weather and climate risks in relation to the actual meteorological conditions they experience.  For this tutorial, a range of potential research questions can be posed:</p>
<ol class="arabic simple">
<li><p>How accurately do people perceive the frequency or severity of extreme weather events in their area?</p></li>
<li><p>Are there socioeconomic or demographic predictors of inaccurate weather risk perception?</p></li>
<li><p>Do people who recall receiving more weather warnings perceive greater weather risk?</p></li>
<li><p>Is there a mismatch between how meteorologists frame risk (as understood by watches and warnings) and how the public interprets it?</p></li>
<li><p>Are individuals who have experienced extreme weather more likely to change their behavior or risk perception?</p></li>
</ol>
</section>
<section id="introduction-and-setup-imports">
<h2>Introduction and Setup (Imports)<a class="headerlink" href="#introduction-and-setup-imports" title="Link to this heading">#</a></h2>
<p>In Jupyter, there are a large number of python-based ‚Äúlibraries‚Äù that help with data loading, transformation, and analysis.  These libraries provide tools that help us do things like make graphs, work with data, or do more complex calculations, like regression.  It‚Äôs good practice to have all libraries imported at the beginning.  You can always add (even install) libraries as you go along, you just have to rerun the cells (or restart the kernel if a new install).</p>
<p>In this tutorial, the primary libraries we will use are:</p>
<ul class="simple">
<li><p><strong>pandas</strong>: For working with tabular data in DataFrames.  It is commonly imported with an alias (pd), so we don‚Äôt constantly have to type out pandas.</p></li>
<li><p><strong>requests</strong>: For easily fetching data from web APIs and URLs (using GET, POST, etc).</p></li>
<li><p><strong>timedelta</strong>: Imported from the datetime library, for representing time intervals.</p></li>
<li><p><strong>BytesIO</strong>: Imported from the IO library, for treating in-memory bytes like a file for reading.</p></li>
<li><p><strong>geopandas</strong>: To work with geospatial data, allowing us to perform spatial operations and handle geometries such as points, polygons, and lines.</p></li>
<li><p><strong>Point</strong>: Imported from Shapely, for creating geometric points for mapping.</p></li>
<li><p><strong>Pyplot</strong>: Imported from MatPlotLib using the alias ‚Äúplt‚Äù, for making simple customizable  plots and charts.</p></li>
<li><p><strong>Seaborn</strong>: Imported using the alias ‚Äúsns‚Äù, for creating statistical and more visually appealing plots.</p></li>
<li><p><strong>time</strong>: Provides functions for working with time, such as measuring durations, pausing executions, and accessing system time.</p></li>
<li><p><strong>tqdm</strong>: Adds progress bars to loops for tracking execution.</p></li>
<li><p><strong>scipy.stats.chi2_contingency</strong>: Imported from Scipy, to run a chi-square test of independence to check if two categorical variables are related.</p></li>
<li><p><strong>statsmodels.api as sm</strong>: Imported with the alias ‚Äúsm‚Äù, it provides tools for statistical models, including logistic regression.</p></li>
<li><p><strong>OrderedModel</strong>: Imported from statsmodels, used for ordinal logistic regression models when outcomes are ordered categories.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#import libraries</span>

<span class="c1"># data handling</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>

<span class="c1"># geospatial</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.geometry</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point</span>

<span class="c1">#visualization</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="c1">#utilities</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1">#statistical modeling/inference</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">chi2_contingency</span>        
<span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>                    
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.miscmodels.ordinal_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedModel</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-1-search-for-datasets">
<h2>Step 1: Search for Datasets<a class="headerlink" href="#step-1-search-for-datasets" title="Link to this heading">#</a></h2>
<p>In this step, we will explore API access to a data repository, the Harvard Dataverse.  An API (Application Programming Interface) is just a set of rules and tools that allows different software to communication and interact with each other.  In this case, we want our Jupyter notebook to interact with the server for information on datasets.  We use the python library ‚ÄúRequests‚Äù to simplify and automate our requests, and Dataverse returns what we requested (hopefully), typically in a format called JSON.  We then use Pandas to transform the JSON in a dataframe, making the results easier to read and manipulate.</p>
<ul class="simple">
<li><p><strong>Note</strong>: Not all APIs are created equally and there might be differences across repositories.  Check each API‚Äôs documentation for how to get started, authentication, search and data access, and more.  For Harvard‚Äôs Dataverse, the <a class="reference external" href="https://guides.dataverse.org/en/latest/api/index.html">Dataverse API Guide</a> is a comprehensive, up-to-date documentation for all operations in Harvard‚Äôs Dataverse.</p></li>
</ul>
<section id="simple-search-for-10-results">
<h3>Simple search for 10 results<a class="headerlink" href="#simple-search-for-10-results" title="Link to this heading">#</a></h3>
<p>By default, the Harvard Dataverse only returns 10 results per search request.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># requires requests and pandas</span>

<span class="c1"># Define search query</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;ripberger&quot;</span>
<span class="n">search_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://dataverse.harvard.edu/api/search?q=</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&amp;type=dataset&quot;</span>

<span class="c1"># Perform search</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">search_url</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Convert items to DataFrame</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

<span class="c1"># Show key columns</span>
<span class="c1">#df_results[[&#39;name&#39;, &#39;global_id&#39;, &#39;published_at&#39;, &#39;citation&#39;]]</span>
<span class="n">df_results</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>type</th>
      <th>url</th>
      <th>global_id</th>
      <th>description</th>
      <th>published_at</th>
      <th>publisher</th>
      <th>citationHtml</th>
      <th>identifier_of_dataverse</th>
      <th>name_of_dataverse</th>
      <th>...</th>
      <th>versionState</th>
      <th>majorVersion</th>
      <th>minorVersion</th>
      <th>createdAt</th>
      <th>updatedAt</th>
      <th>contacts</th>
      <th>publications</th>
      <th>authors</th>
      <th>image_url</th>
      <th>keywords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A comprehensive inventory and review of color ...</td>
      <td>dataset</td>
      <td>https://doi.org/10.7910/DVN/IFBAZ4</td>
      <td>doi:10.7910/DVN/IFBAZ4</td>
      <td>This dataset contains an inventory of colors u...</td>
      <td>2025-04-22T13:26:32Z</td>
      <td>Harvard Dataverse</td>
      <td>Ripberger, Joseph; Bitterman, Abby; Rosen, Zoe...</td>
      <td>harvard</td>
      <td>Harvard Dataverse</td>
      <td>...</td>
      <td>RELEASED</td>
      <td>1</td>
      <td>0</td>
      <td>2025-03-27T13:54:15Z</td>
      <td>2025-04-22T13:26:32Z</td>
      <td>[{'name': 'Ripberger, Joseph', 'affiliation': ...</td>
      <td>[{}]</td>
      <td>[Ripberger, Joseph, Bitterman, Abby, Rosen, Zoey]</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>WX18</td>
      <td>dataset</td>
      <td>https://doi.org/10.7910/DVN/RHT4ON</td>
      <td>doi:10.7910/DVN/RHT4ON</td>
      <td>The Severe Weather and Society Survey (WX) was...</td>
      <td>2020-02-03T22:11:23Z</td>
      <td>Extreme Weather and Society Survey</td>
      <td>Ripberger, Joseph; Silva, Carol; Jenkins-Smith...</td>
      <td>wxsurvey</td>
      <td>Extreme Weather and Society Survey</td>
      <td>...</td>
      <td>RELEASED</td>
      <td>1</td>
      <td>1</td>
      <td>2020-01-13T14:26:39Z</td>
      <td>2020-09-01T14:43:00Z</td>
      <td>[{'name': 'Ripberger, Joseph', 'affiliation': ...</td>
      <td>[{}]</td>
      <td>[Ripberger, Joseph, Silva, Carol, Jenkins-Smit...</td>
      <td>https://dataverse.harvard.edu/api/datasets/365...</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WX19</td>
      <td>dataset</td>
      <td>https://doi.org/10.7910/DVN/MLCJEW</td>
      <td>doi:10.7910/DVN/MLCJEW</td>
      <td>The Severe Weather and Society Survey (WX) was...</td>
      <td>2020-02-03T22:10:59Z</td>
      <td>Extreme Weather and Society Survey</td>
      <td>Ripberger, Joseph; Silva, Carol; Jenkins-Smith...</td>
      <td>wxsurvey</td>
      <td>Extreme Weather and Society Survey</td>
      <td>...</td>
      <td>RELEASED</td>
      <td>1</td>
      <td>1</td>
      <td>2020-01-13T14:28:14Z</td>
      <td>2020-09-01T14:43:57Z</td>
      <td>[{'name': 'Ripberger, Joseph', 'affiliation': ...</td>
      <td>[{}]</td>
      <td>[Ripberger, Joseph, Silva, Carol, Jenkins-Smit...</td>
      <td>https://dataverse.harvard.edu/api/datasets/365...</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>WX17</td>
      <td>dataset</td>
      <td>https://doi.org/10.7910/DVN/GSTYK4</td>
      <td>doi:10.7910/DVN/GSTYK4</td>
      <td>The Severe Weather and Society Survey (WX17) w...</td>
      <td>2020-02-03T22:10:34Z</td>
      <td>Extreme Weather and Society Survey</td>
      <td>Ripberger, Joseph; Silva, Carol; Jenkins-Smith...</td>
      <td>wxsurvey</td>
      <td>Extreme Weather and Society Survey</td>
      <td>...</td>
      <td>RELEASED</td>
      <td>1</td>
      <td>1</td>
      <td>2020-01-28T20:00:17Z</td>
      <td>2020-09-01T14:41:58Z</td>
      <td>[{'name': 'Ripberger, Joseph', 'affiliation': ...</td>
      <td>[{}]</td>
      <td>[Ripberger, Joseph, Silva, Carol, Jenkins-Smit...</td>
      <td>https://dataverse.harvard.edu/api/datasets/367...</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>WX20</td>
      <td>dataset</td>
      <td>https://doi.org/10.7910/DVN/EWOCUA</td>
      <td>doi:10.7910/DVN/EWOCUA</td>
      <td>The Severe Weather and Society Survey (WX) was...</td>
      <td>2020-09-01T14:03:39Z</td>
      <td>Extreme Weather and Society Survey</td>
      <td>Ripberger, Joseph; Krocak, Makenzie; Silva, Ca...</td>
      <td>wxsurvey</td>
      <td>Extreme Weather and Society Survey</td>
      <td>...</td>
      <td>RELEASED</td>
      <td>2</td>
      <td>1</td>
      <td>2020-08-05T13:29:07Z</td>
      <td>2020-09-01T14:46:05Z</td>
      <td>[{'name': 'Ripberger, Joseph', 'affiliation': ...</td>
      <td>[{}]</td>
      <td>[Ripberger, Joseph, Krocak, Makenzie, Silva, C...</td>
      <td>https://dataverse.harvard.edu/api/datasets/400...</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows √ó 26 columns</p>
</div></div></div>
</div>
</section>
<section id="search-with-more-than-10-results">
<h3>Search with more than 10 results<a class="headerlink" href="#search-with-more-than-10-results" title="Link to this heading">#</a></h3>
<p>We can make an API call that goes beyond the 10 result limit by creating a loop.  The ‚Äúwhile True‚Äù statement will continue running (10 results at a time) until there are no results remaining.  We collect all of the results in one list using the ‚Äúextend‚Äù command.  Finally, we can limit the dataframe to only view a subset of columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;ripberger&quot;</span>
<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">per_page</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Max per page is 100</span>
<span class="n">all_items</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">search_url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://dataverse.harvard.edu/api/search?&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;q=</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&amp;type=dataset&amp;start=</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">&amp;per_page=</span><span class="si">{</span><span class="n">per_page</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">search_url</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    
    <span class="n">items</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>
    <span class="n">all_items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
    
    <span class="c1"># Break if fewer than per_page results are returned (i.e., last page)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">per_page</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">start</span> <span class="o">+=</span> <span class="n">per_page</span>

<span class="c1"># Convert to DataFrame</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_items</span><span class="p">)</span>
<span class="n">df_results</span><span class="p">[[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;global_id&#39;</span><span class="p">,</span> <span class="s1">&#39;published_at&#39;</span><span class="p">,</span> <span class="s1">&#39;citation&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">12</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">search_url</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>         <span class="sa">f</span><span class="s2">&quot;https://dataverse.harvard.edu/api/search?&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>         <span class="sa">f</span><span class="s2">&quot;q=</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&amp;type=dataset&amp;start=</span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2">&amp;per_page=</span><span class="si">{</span><span class="n">per_page</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">12</span>     <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">search_url</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">items</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;items&#39;</span><span class="p">]</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/site-packages/requests/api.py:73,</span> in <span class="ni">get</span><span class="nt">(url, params, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span> <span class="k">def</span><span class="w"> </span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span><span class="w">     </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sends a GET request.</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">65</span><span class="sd">     :param url: URL for the new :class:`Request` object.</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span><span class="sd">     :rtype: requests.Response</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">73</span>     <span class="k">return</span> <span class="n">request</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/site-packages/requests/api.py:59,</span> in <span class="ni">request</span><span class="nt">(method, url, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="c1"># By using the &#39;with&#39; statement we are sure the session is closed, thus we</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="c1"># avoid leaving sockets open which can trigger a ResourceWarning in some</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="c1"># cases, and look like a memory leak in others.</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span> <span class="k">with</span> <span class="n">sessions</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">59</span>     <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/site-packages/requests/sessions.py:589,</span> in <span class="ni">Session.request</span><span class="nt">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span> <span class="n">send_kwargs</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>     <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="n">timeout</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>     <span class="s2">&quot;allow_redirects&quot;</span><span class="p">:</span> <span class="n">allow_redirects</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">588</span> <span class="n">send_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">589</span> <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">prep</span><span class="p">,</span> <span class="o">**</span><span class="n">send_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">591</span> <span class="k">return</span> <span class="n">resp</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/site-packages/requests/sessions.py:703,</span> in <span class="ni">Session.send</span><span class="nt">(self, request, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span> <span class="n">start</span> <span class="o">=</span> <span class="n">preferred_clock</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">702</span> <span class="c1"># Send the request</span>
<span class="ne">--&gt; </span><span class="mi">703</span> <span class="n">r</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">705</span> <span class="c1"># Total elapsed time of the request (approximately)</span>
<span class="g g-Whitespace">    </span><span class="mi">706</span> <span class="n">elapsed</span> <span class="o">=</span> <span class="n">preferred_clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/site-packages/requests/adapters.py:644,</span> in <span class="ni">HTTPAdapter.send</span><span class="nt">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="g g-Whitespace">    </span><span class="mi">641</span>     <span class="n">timeout</span> <span class="o">=</span> <span class="n">TimeoutSauce</span><span class="p">(</span><span class="n">connect</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">643</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">644</span>     <span class="n">resp</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">645</span>         <span class="n">method</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">646</span>         <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">647</span>         <span class="n">body</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">648</span>         <span class="n">headers</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">649</span>         <span class="n">redirect</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">650</span>         <span class="n">assert_same_host</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">651</span>         <span class="n">preload_content</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">652</span>         <span class="n">decode_content</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">653</span>         <span class="n">retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">654</span>         <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">655</span>         <span class="n">chunked</span><span class="o">=</span><span class="n">chunked</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">656</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">658</span> <span class="k">except</span> <span class="p">(</span><span class="n">ProtocolError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">659</span>     <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/site-packages/urllib3/connectionpool.py:787,</span> in <span class="ni">HTTPConnectionPool.urlopen</span><span class="nt">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, preload_content, decode_content, **response_kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">784</span> <span class="n">response_conn</span> <span class="o">=</span> <span class="n">conn</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">release_conn</span> <span class="k">else</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">786</span> <span class="c1"># Make the request on the HTTPConnection object</span>
<span class="ne">--&gt; </span><span class="mi">787</span> <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_request</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">788</span>     <span class="n">conn</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">789</span>     <span class="n">method</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">790</span>     <span class="n">url</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">791</span>     <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_obj</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">792</span>     <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">793</span>     <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">794</span>     <span class="n">chunked</span><span class="o">=</span><span class="n">chunked</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">795</span>     <span class="n">retries</span><span class="o">=</span><span class="n">retries</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">796</span>     <span class="n">response_conn</span><span class="o">=</span><span class="n">response_conn</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">797</span>     <span class="n">preload_content</span><span class="o">=</span><span class="n">preload_content</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">798</span>     <span class="n">decode_content</span><span class="o">=</span><span class="n">decode_content</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">799</span>     <span class="o">**</span><span class="n">response_kw</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">800</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">802</span> <span class="c1"># Everything went great!</span>
<span class="g g-Whitespace">    </span><span class="mi">803</span> <span class="n">clean_exit</span> <span class="o">=</span> <span class="kc">True</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/site-packages/urllib3/connectionpool.py:534,</span> in <span class="ni">HTTPConnectionPool._make_request</span><span class="nt">(self, conn, method, url, body, headers, retries, timeout, chunked, response_conn, preload_content, decode_content, enforce_content_length)</span>
<span class="g g-Whitespace">    </span><span class="mi">532</span> <span class="c1"># Receive the response from the server</span>
<span class="g g-Whitespace">    </span><span class="mi">533</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">534</span>     <span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">535</span> <span class="k">except</span> <span class="p">(</span><span class="n">BaseSSLError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">536</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_raise_timeout</span><span class="p">(</span><span class="n">err</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout_value</span><span class="o">=</span><span class="n">read_timeout</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/site-packages/urllib3/connection.py:565,</span> in <span class="ni">HTTPConnection.getresponse</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">562</span> <span class="n">_shutdown</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="p">,</span> <span class="s2">&quot;shutdown&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">564</span> <span class="c1"># Get the response from http.client.HTTPConnection</span>
<span class="ne">--&gt; </span><span class="mi">565</span> <span class="n">httplib_response</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">567</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">568</span>     <span class="n">assert_header_parsing</span><span class="p">(</span><span class="n">httplib_response</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/http/client.py:1375,</span> in <span class="ni">HTTPConnection.getresponse</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1373</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1374</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1375</span>         <span class="n">response</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1376</span>     <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1377</span>         <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/http/client.py:318,</span> in <span class="ni">HTTPResponse.begin</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">316</span> <span class="c1"># read until we get a non-100 response</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span> <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">318</span>     <span class="n">version</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_status</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span>     <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">CONTINUE</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">320</span>         <span class="k">break</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/http/client.py:279,</span> in <span class="ni">HTTPResponse._read_status</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">278</span> <span class="k">def</span><span class="w"> </span><span class="nf">_read_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">279</span>     <span class="n">line</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">_MAXLINE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;iso-8859-1&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">280</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">_MAXLINE</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">281</span>         <span class="k">raise</span> <span class="n">LineTooLong</span><span class="p">(</span><span class="s2">&quot;status line&quot;</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/socket.py:717,</span> in <span class="ni">SocketIO.readinto</span><span class="nt">(self, b)</span>
<span class="g g-Whitespace">    </span><span class="mi">715</span> <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">716</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">717</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">recv_into</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">718</span>     <span class="k">except</span> <span class="n">timeout</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">719</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_timeout_occurred</span> <span class="o">=</span> <span class="kc">True</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/ssl.py:1307,</span> in <span class="ni">SSLSocket.recv_into</span><span class="nt">(self, buffer, nbytes, flags)</span>
<span class="g g-Whitespace">   </span><span class="mi">1303</span>     <span class="k">if</span> <span class="n">flags</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1304</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1305</span>           <span class="s2">&quot;non-zero flags not allowed in calls to recv_into() on </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
<span class="g g-Whitespace">   </span><span class="mi">1306</span>           <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1307</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nbytes</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1308</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1309</span>     <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">recv_into</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">nbytes</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/data-forums/lib/python3.10/ssl.py:1163,</span> in <span class="ni">SSLSocket.read</span><span class="nt">(self, len, buffer)</span>
<span class="g g-Whitespace">   </span><span class="mi">1161</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1162</span>     <span class="k">if</span> <span class="n">buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1163</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sslobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1164</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1165</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sslobj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#How many datasets?  Each row (first number) represents a dataset.</span>
<span class="n">df_results</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="subsetting-our-results">
<h3>Subsetting Our Results<a class="headerlink" href="#subsetting-our-results" title="Link to this heading">#</a></h3>
<p>Let‚Äôs say we don‚Äôt want all of these, but only a subset of related surveys.  For this step, and the remainder of notebook, we will focus on the yearly waves of the Extreme Weather and Society Survey (WXYY). So let‚Äôs subset them the dataframe from the earlier API call.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the dataset names you want to filter on</span>
<span class="n">target_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WX17&quot;</span><span class="p">,</span> <span class="s2">&quot;WX18&quot;</span><span class="p">,</span> <span class="s2">&quot;WX19&quot;</span><span class="p">,</span> <span class="s2">&quot;WX20&quot;</span><span class="p">,</span> <span class="s2">&quot;WX21&quot;</span><span class="p">,</span> <span class="s2">&quot;WX22&quot;</span><span class="p">,</span> <span class="s2">&quot;WX23&quot;</span><span class="p">,</span> <span class="s2">&quot;WX24&quot;</span><span class="p">]</span>

<span class="c1"># Subset the dataframe</span>
<span class="n">df_subset</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">target_names</span><span class="p">)]</span>

<span class="c1"># Display the result</span>
<span class="n">df_subset</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="step-2-get-dataset-metadata-and-files">
<h2>Step 2: Get Dataset Metadata and Files<a class="headerlink" href="#step-2-get-dataset-metadata-and-files" title="Link to this heading">#</a></h2>
<section id="getting-metadata-for-a-single-dataset">
<h3>Getting metadata for a single dataset<a class="headerlink" href="#getting-metadata-for-a-single-dataset" title="Link to this heading">#</a></h3>
<p>Let‚Äôs examine the metadata for one of the datasets in the subset, WX18.  The Dataverse uses it‚Äôs own API file metadata.  First, we will look at file-level metadata.  Next, we will pull the full dataset metadata.  Since the results will be in JSON, we will convert that to a flat file.</p>
</section>
<section id="file-level-metadata">
<h3>File level metadata<a class="headerlink" href="#file-level-metadata" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract persistent ID (DOI) from the first row [0] by position</span>
<span class="n">persistent_id</span> <span class="o">=</span> <span class="n">df_subset</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;global_id&#39;</span><span class="p">]</span>

<span class="c1"># Get dataset metadata</span>
<span class="n">metadata_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://dataverse.harvard.edu/api/datasets/:persistentId/?persistentId=</span><span class="si">{</span><span class="n">persistent_id</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">metadata_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metadata_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Display list of files</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">metadata_response</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;latestVersion&#39;</span><span class="p">][</span><span class="s1">&#39;files&#39;</span><span class="p">]</span>
<span class="n">files</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="full-dataset-metadata">
<h3>Full dataset metadata<a class="headerlink" href="#full-dataset-metadata" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract persistent ID (DOI) from the first row</span>
<span class="n">persistent_id</span> <span class="o">=</span> <span class="n">df_subset</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;global_id&#39;</span><span class="p">]</span>

<span class="c1"># Get full dataset metadata (latest version)</span>
<span class="n">metadata_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://dataverse.harvard.edu/api/datasets/:persistentId/versions/:latest?persistentId=</span><span class="si">{</span><span class="n">persistent_id</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">metadata_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metadata_url</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="c1"># Display the JSON</span>
<span class="n">metadata_response</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="transform-the-results-from-json">
<h3>Transform the results from JSON<a class="headerlink" href="#transform-the-results-from-json" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flatten JSON into a single row using json_normalize</span>
<span class="n">df_meta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">metadata_response</span><span class="p">)</span>

<span class="c1"># Transpose so keys become a column and values another</span>
<span class="n">df_meta_t</span> <span class="o">=</span> <span class="n">df_meta</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_meta_t</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">]</span>

<span class="n">df_meta_t</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>  <span class="c1"># show first 20 rows</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="getting-metadata-for-multiple-datasets">
<h3>Getting metadata for multiple datasets<a class="headerlink" href="#getting-metadata-for-multiple-datasets" title="Link to this heading">#</a></h3>
<p>Let‚Äôs say we want the file-level metadata for all waves.  Against, we set up a loop call, to loop through all of the files using the persistent ID (DOI) and pick up the metadata information we want.  This time, we will limit the items we want to see (as seen in the ‚Äúfor f in files‚Äù loop below) and have the results formatted into a dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an empty list to hold all file metadata</span>
<span class="n">all_files</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Loop through persistent IDs</span>
<span class="k">for</span> <span class="n">pid</span> <span class="ow">in</span> <span class="n">df_subset</span><span class="p">[</span><span class="s1">&#39;global_id&#39;</span><span class="p">]:</span>
    <span class="n">metadata_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://dataverse.harvard.edu/api/datasets/:persistentId/?persistentId=</span><span class="si">{</span><span class="n">pid</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metadata_url</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;latestVersion&#39;</span><span class="p">][</span><span class="s1">&#39;files&#39;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="n">file_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;dataset_title&#39;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;latestVersion&#39;</span><span class="p">][</span><span class="s1">&#39;metadataBlocks&#39;</span><span class="p">][</span><span class="s1">&#39;citation&#39;</span><span class="p">][</span><span class="s1">&#39;fields&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                <span class="s1">&#39;file_id&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;dataFile&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span>
                <span class="s1">&#39;file_label&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span>
                <span class="s1">&#39;file_size&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;dataFile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filesize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="s1">&#39;file_description&#39;</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="s1">&#39;persistent_id&#39;</span><span class="p">:</span> <span class="n">pid</span>
            <span class="p">}</span>
            <span class="n">all_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_info</span><span class="p">)</span>
    
    <span class="c1"># Be respectful of API limits</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Convert to DataFrame</span>
<span class="n">df_files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_files</span><span class="p">)</span>
<span class="n">df_files</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="step-3-download-a-file">
<h2>Step 3: Download a File<a class="headerlink" href="#step-3-download-a-file" title="Link to this heading">#</a></h2>
<p>Above, we see that each dataset file (.tab) is accompanied by PDFs of the instrument and a reference report.</p>
<p>Let‚Äôs download the dataset file (.tab) for first year of the survey, WX18, which has a file_id of ‚Äú3657710‚Äù.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># File ID for WxEM_Wave1.tab</span>
<span class="n">file_id</span> <span class="o">=</span> <span class="mi">3657710</span>

<span class="c1"># Download directly to memory</span>
<span class="n">file_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://dataverse.harvard.edu/api/access/datafile/</span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">?format=original&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>

<span class="c1"># Load into pandas directly from memory, assuming comma-delimited content</span>
<span class="n">df_18</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;ISO-8859-1&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="n">on_bad_lines</span><span class="o">=</span><span class="s1">&#39;skip&#39;</span><span class="p">)</span>
<span class="n">df_18</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="examine-the-dataset">
<h3>Examine the dataset<a class="headerlink" href="#examine-the-dataset" title="Link to this heading">#</a></h3>
<p>Pandas has a number of attributes that can be used to examine characteristics of the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># See basic shape of the data (rows, columns).  Each row represents a respondent.</span>
<span class="n">df_18</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<section id="variable-names">
<h4>Variable names<a class="headerlink" href="#variable-names" title="Link to this heading">#</a></h4>
<p>Listing the columns shows all the variable names contained in the data.  To integrate with weather data, we are most interested in locating possible ways to join the data.  Typically, geographic variables are a good start.  In this survey, some good possible variables are state, zip, lat/lon.  These are pretty straightforward, but what about ‚Äúnws_region‚Äù?  Does it contain WFOs?  Let‚Äôs examine.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List all column names</span>
<span class="n">df_18</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Is nws_region usefl at all?</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;nws_region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<section id="unfortunately-nws-region-only-has-four-regions-nonetheless-it-might-be-useful-at-some-point">
<h5>Unfortunately, ‚Äúnws_region‚Äù only has four regions.  Nonetheless, it might be useful at some point.<a class="headerlink" href="#unfortunately-nws-region-only-has-four-regions-nonetheless-it-might-be-useful-at-some-point" title="Link to this heading">#</a></h5>
</section>
</section>
</section>
</section>
<section id="step-4-merge-with-weather-data">
<h2>Step 4: Merge with Weather Data<a class="headerlink" href="#step-4-merge-with-weather-data" title="Link to this heading">#</a></h2>
<p>In this example, we will extract warnings/watches/advisories from the Iowa Mesonet for each respondent three days prior to the start of the survey.  I know, that‚Äôs pretty arbitrary but perhaps we‚Äôre interested in the impact of the weather on responses to a weather survey.</p>
<p>For each respondent, we will use their:</p>
<ol class="arabic simple">
<li><p>lat, lon, and begin_date</p></li>
<li><p>Query the IEM for any warnings/watches/advisories issued within 3 days prior to begin_date</p></li>
<li><p>Store or summarize those results (e.g., number of WWAs, types, text, etc.)</p></li>
</ol>
<p>Please note the API Endpoint (Rest-like) and the structure of the request for those variables:</p>
<p><a class="reference external" href="https://mesonet.agron.iastate.edu/vtec/json.php?lon=%7Blon%7D&amp;amp;lat=%7Blat%7D&amp;amp;sdate=%7Bstart%7D&amp;amp;edate=%7Bend%7D">https://mesonet.agron.iastate.edu/vtec/json.php?lon={lon}&amp;lat={lat}&amp;sdate={start}&amp;edate={end}</a></p>
<p>Remember, you can always check the API documentation for guidance: the <a class="reference external" href="https://mesonet.agron.iastate.edu/api/">Iowa Mesonet API Guide</a>.</p>
<p>We will use this API call to loop through all 3,000 respondents and gather their information.</p>
<section id="iowa-mesonet">
<h3>Iowa Mesonet<a class="headerlink" href="#iowa-mesonet" title="Link to this heading">#</a></h3>
<p>So I‚Äôm just going to use lat/lon and the date to directly get watches/warnings/advisories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make sure begin_date is in datetime format</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;begin_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;begin_date&#39;</span><span class="p">])</span>

<span class="c1"># New column to store list of WWA names</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Loop through each respondent</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">df_18</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_18</span><span class="p">)):</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;begin_date&#39;</span><span class="p">]</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Build API URL</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://mesonet.agron.iastate.edu/json/vtec_events_bypoint.py&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;?lat=</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">&amp;lon=</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">&amp;sdate=</span><span class="si">{</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&amp;edate=</span><span class="si">{</span><span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">,</span> <span class="p">[])]</span>
            <span class="n">df_18</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">names</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_18</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed for idx=</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">, lat=</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s2">, lon=</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">df_18</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#let&#39;s examine what we just collected.  We use the attribute &quot;dropna&quot; to make sure that there are no rows that empty (i.e., we didn&#39;t screw something up).</span>
<span class="n">df_18</span><span class="p">[[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;begin_date&#39;</span><span class="p">,</span> <span class="s1">&#39;wwa_names&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#let&#39;s make sure we have the same number of row that we started with</span>
<span class="n">df_18</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#how many respondents experienced watches/warnings/advisories?</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#who received a tornado warning?</span>
<span class="n">df_18</span><span class="p">[</span><span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;Tornado Warning&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#who received more than two?</span>
<span class="n">df_18</span><span class="p">[</span>
    <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">][[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;begin_date&#39;</span><span class="p">,</span> <span class="s1">&#39;wwa_names&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="quick-visualizations-of-the-watches-and-warnings">
<h3>Quick Visualizations of the Watches and Warnings<a class="headerlink" href="#quick-visualizations-of-the-watches-and-warnings" title="Link to this heading">#</a></h3>
<p>Here are some quick descriptive visualizations to view the data.</p>
<ol class="arabic simple">
<li><p>A geomap of survey respondents by number of watches and warnings 3 days prior to the survey.</p></li>
<li><p>A bar chart showing frequency of types of watches and warnings.</p></li>
<li><p>A line graph showing frequency of types of watches and warning over time.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Ensure lat/lon are float (just in case)</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Step 2: Create geometry from lat/lon</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="k">for</span> <span class="n">xy</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">])]</span>
<span class="n">gdf_18</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df_18</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">geometry</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Count WWAs</span>
<span class="n">gdf_18</span><span class="p">[</span><span class="s1">&#39;wwa_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf_18</span><span class="p">[</span><span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Step 4: Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">gdf_18</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;wwa_count&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;OrRd&#39;</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Survey Respondents by Number of WWAs (3 Days Prior)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Flatten and count</span>
<span class="n">all_names</span> <span class="o">=</span> <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span>
<span class="n">top_names</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_names</span><span class="p">)</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">names</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">top_names</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">names</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">counts</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Top 10 Most Frequent WWAs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Respondents Exposed&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count WWAs per date</span>
<span class="n">timeline</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_18</span><span class="p">[[</span><span class="s1">&#39;begin_date&#39;</span><span class="p">,</span> <span class="s1">&#39;wwa_names&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">wwa_count</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">))</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;begin_date&#39;</span><span class="p">)[</span><span class="s1">&#39;wwa_count&#39;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">timeline</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Total WWAs by Survey Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Warnings/Watch Events&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Survey Date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizing-wwwas-by-survey-reponses">
<h3>Visualizing WWWAs by Survey Reponses<a class="headerlink" href="#visualizing-wwwas-by-survey-reponses" title="Link to this heading">#</a></h3>
<p>For a next step, we might do some quick analyses/visualizations of WWAs by survey response.  Perhaps even make an interactive version with a dropdown of survey responses that a user can play with?</p>
<p>Let‚Äôs say we want to examine how the presence of recent NWS advisories (3 days prior to taking the survey) correlates with survey respondents‚Äô perceived risk of that hazard.  How can we do that?</p>
<p>Step 1.  Create two groups of respondents, those experienced a WWA prior to the survey and those who did not.
Step 2.  Extract risk perception scores for a hazard (For risk_flood: 1-No risk, 2-Low Risk‚Ä¶..5-Extreme risk)
Step 3.  Create comparative visualizations</p>
<p>For these visualizations, we will focus on exposure to flood watches and warnings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Prep: robust WWA exposure + ordered risk labels ---</span>

<span class="c1"># 1) robust flood_wwa_exposure (handles NaN/non-lists)</span>
<span class="n">flood_wwa_keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Flood Advisory&#39;</span><span class="p">,</span> <span class="s1">&#39;Flood Warning&#39;</span><span class="p">,</span> <span class="s1">&#39;Flash Flood Warning&#39;</span><span class="p">,</span> <span class="s1">&#39;Flash Flood Watch&#39;</span><span class="p">,</span> <span class="s1">&#39;Flood Watch&#39;</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">has_flood_wwa</span><span class="p">(</span><span class="n">wwas</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wwas</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">wwas</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">flood_wwa_keywords</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;wwa_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">has_flood_wwa</span><span class="p">)</span>

<span class="c1"># 2) numeric -&gt; labeled flood risk (ordered categorical)</span>
<span class="n">label_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;No risk&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;Low risk&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Moderate risk&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;High risk&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;Extreme risk&#39;</span><span class="p">}</span>
<span class="n">ordered_risk_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">label_map</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="c1"># Coerce to numeric, map to labels, and set categorical order</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;risk_flood_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_18</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;risk_flood&#39;</span><span class="p">),</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;risk_flood_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
    <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;risk_flood_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">label_map</span><span class="p">),</span>
    <span class="n">categories</span><span class="o">=</span><span class="n">ordered_risk_labels</span><span class="p">,</span>
    <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">df_18</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;risk_flood_label&#39;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="n">ordered_risk_labels</span><span class="p">,</span>
    <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Perceived Flood Risk&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of Respondents&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Perceived Flood Risk by Exposure to Flood-Related WWAs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;WWA Exposure&quot;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;No&quot;</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># crosstab -&gt; proportions by exposure</span>
<span class="n">crosstab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span>
    <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">],</span>
    <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;risk_flood_label&#39;</span><span class="p">],</span>
    <span class="n">normalize</span><span class="o">=</span><span class="s1">&#39;index&#39;</span>
<span class="p">)</span>

<span class="c1"># ensure consistent order of rows/columns even if some levels are missing</span>
<span class="n">crosstab</span> <span class="o">=</span> <span class="n">crosstab</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">ordered_risk_labels</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">crosstab</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flood Risk Perception by WWA Exposure (Proportions)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Perceived Flood Risk&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Proportion of Respondents&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Exposed to Flood WWA&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;No&#39;</span><span class="p">,</span> <span class="s1">&#39;Yes&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I don&#39;t personally like violin plots, but let&#39;s take a look</span>
<span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_18</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;risk_flood&#39;</span><span class="p">,</span> <span class="n">inner</span><span class="o">=</span><span class="s1">&#39;quartile&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;No WWA Exposure&#39;</span><span class="p">,</span> <span class="s1">&#39;WWA Exposure&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Exposure to Flood WWA&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Perceived Flood Risk (1-5)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of Flood Risk Perception by WWA Exposure&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="going-further">
<h2>Going further<a class="headerlink" href="#going-further" title="Link to this heading">#</a></h2>
<p>We‚Äôre not limited to visualizations, we can explore a number of statistical procedures to really test our question of whether exposure to warnings and watches has an impact on survey responses.  For this tutorial, we will quickly conduct the following:</p>
<ol class="arabic simple">
<li><p>Chi-Square: To evaluate whether exposure to flood-related warnings and watches and perceived flood risk categories are independent, with the p-value indicating if the observed relationship is statistically significant.</p></li>
<li><p>Logistic Regression: To evaluate whether exposure to flood-related warnings and watches increases the odds of respondents reporting high or extreme flood risk compared to lower risk levels.</p></li>
<li><p>Ordinal Logistic Regression: To evaluate whether exposure to flood-related warnings and watches shifts respondents toward higher categories of perceived flood risk.</p></li>
</ol>
<section id="chi-square">
<h3>Chi-Square<a class="headerlink" href="#chi-square" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># contingency table: WWA exposure vs. risk perception</span>
<span class="n">contingency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">],</span> <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;risk_flood_label&#39;</span><span class="p">])</span>
<span class="n">chi2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">expected</span> <span class="o">=</span> <span class="n">chi2_contingency</span><span class="p">(</span><span class="n">contingency</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Chi-square test&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chi2 = </span><span class="si">{</span><span class="n">chi2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, df = </span><span class="si">{</span><span class="n">dof</span><span class="si">}</span><span class="s2">, p = </span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This suggests that the distribution of flood risk perceptions is not independent of WWA exposure ‚Äî in other words, people who were exposed to flood-related WWAs responded differently (in terms of risk levels) than those who were not exposed.</p>
</section>
<section id="logistic-regression">
<h3>Logistic Regression<a class="headerlink" href="#logistic-regression" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Binary outcome: high risk (‚â•4) vs. lower</span>
<span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;high_risk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;risk_flood_num&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">4</span>

<span class="c1"># Predictor: WWA exposure (cast to int)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_18</span><span class="p">[</span><span class="s1">&#39;high_risk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">logit_model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">Logit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">logit_model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>This suggests that respondents exposed to a flood WWA had significantly higher odds (about 39% greater, exp(0.3326) ‚âà 1.39) of reporting high or extreme flood risk compared to those not exposed, though the overall model explains only a small share of variation in responses.</p>
</section>
<section id="ordinal-logistic-regression">
<h3>Ordinal Logistic Regression<a class="headerlink" href="#ordinal-logistic-regression" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Drop NaNs to avoid issues</span>
<span class="n">df_ord</span> <span class="o">=</span> <span class="n">df_18</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;risk_flood_num&#39;</span><span class="p">,</span> <span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">])</span>

<span class="c1"># Predictor must be numeric (int)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_ord</span><span class="p">[[</span><span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Outcome is ordered categories (numeric risk levels already ordered 1‚Äì5)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_ord</span><span class="p">[</span><span class="s1">&#39;risk_flood_num&#39;</span><span class="p">]</span>

<span class="c1"># Fit ordinal logistic regression</span>
<span class="n">mod</span> <span class="o">=</span> <span class="n">OrderedModel</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">distr</span><span class="o">=</span><span class="s1">&#39;logit&#39;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;bfgs&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>This suggests that respondents exposed to flood-related warnings and watches had a significantly higher likelihood of placing themselves in higher flood risk perception categories (coef = 0.296, p &lt; 0.001), indicating a consistent upward shift in perceived risk.</p>
</section>
</section>
<section id="but-did-wwas-really-affect-risk-perception">
<h2>But Did WWAs <em>Really</em> Affect Risk Perception?<a class="headerlink" href="#but-did-wwas-really-affect-risk-perception" title="Link to this heading">#</a></h2>
<p>So it appears that exposure to watches and warnings has a statistically significant impact on survey responses.  But by how much?  For this, let‚Äôs take a look at the predicted probabilities of survey responses.  This way, we can have an answer for ‚ÄúHow much does exposure to a WWA change the probability of a respondent reporting ‚ÄòHigh‚Äô or ‚ÄòExtreme‚Äô flood risk?‚Äù</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make two scenarios: no exposure (0) and exposure (1)</span>
<span class="n">scenarios</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;flood_wwa_exposure&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Predict probabilities for each risk category</span>
<span class="n">pred_probs</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scenarios</span><span class="p">)</span>

<span class="c1"># Attach labels</span>
<span class="n">pred_probs</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;No Exposure&#39;</span><span class="p">,</span> <span class="s1">&#39;Exposure&#39;</span><span class="p">]</span>
<span class="n">pred_probs</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Risk </span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pred_probs</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

<span class="n">pred_probs</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-possible-interpretation">
<h2>A possible interpretation<a class="headerlink" href="#a-possible-interpretation" title="Link to this heading">#</a></h2>
<p>Respondents who were exposed to a flood WWA were less likely to report no risk (10% ‚Üí 8%) or low risk (32% ‚Üí 28%), and more likely to report higher levels of risk perception, particularly at the ‚ÄúHigh‚Äù (15% ‚Üí 18%) and ‚ÄúExtreme‚Äù (9% ‚Üí 11%) categories. While the percentage point changes may look modest, they indicate a clear upward shift in perceived flood risk among those who received WWAs.  In other words, I think it is possible to say that exposure to a flood warning nudged people away from saying ‚Äòno risk‚Äô and toward saying ‚Äòhigh or extreme risk.  However, with only 3,000 responses, I probably wouldn‚Äôt.  But, as the academics say, this requires further study. üòâ</p>
<p>Now let‚Äôs take a look at a visualization of these results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#let&#39;s see HOW the probability distribution shift</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">pred_probs</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predicted Flood Risk Perception by WWA Exposure&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Perceived Flood Risk Level&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;WWA Exposure&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="wrapping-up">
<h2>Wrapping Up<a class="headerlink" href="#wrapping-up" title="Link to this heading">#</a></h2>
<p>In this tutorial, we explored how to bring together <strong>social survey data</strong> and <strong>weather warning data</strong> to better understand how hazard information influences perceptions of risk. Using the Jupyter Notebook environment, you learned how to:</p>
<ul class="simple">
<li><p><strong>Work with APIs</strong> to search for, access, and download data programmatically</p></li>
<li><p>Organize and explore datasets interactively using <strong>pandas</strong></p></li>
<li><p>Merge survey responses with external data from the <strong>Iowa Environmental Mesonet</strong></p></li>
<li><p>Apply <strong>geospatial tools</strong> to handle location-based data</p></li>
<li><p>Create clear, reproducible <strong>visualizations</strong> directly alongside your analysis</p></li>
<li><p>Document your process in a way that combines code, results, and explanation all in one place</p></li>
</ul>
<p>By the end of this notebook, you‚Äôve seen how Jupyter can serve as both a <strong>research lab and a communication tool</strong>‚Äîa space where you can experiment with data, visualize results, and explain what you find.</p>
<section id="moving-forward">
<h3>Moving Forward<a class="headerlink" href="#moving-forward" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Try adapting this workflow to other survey topics (e.g., heat, drought, tornado risk)</p></li>
<li><p>Explore additional Mesonet or NOAA APIs to enrich your analysis with different kinds of data</p></li>
<li><p>Use Jupyter notebooks to build <strong>reproducible reports</strong>, where readers can see not just your conclusions but also the steps you took to get there</p></li>
<li><p>Share your notebooks with collaborators as a way to make your analysis <strong>transparent and interactive</strong></p></li>
</ul>
<p>Ultimately, the key takeaway is that with just a few tools‚Äî<strong>APIs, pandas, geospatial libraries, and Jupyter notebooks</strong>‚Äîyou can connect diverse datasets, analyze them in context, and tell meaningful data stories about risk and society.</p>
<hr class="docutils" />
<p><strong>Thank you for following along!</strong><br />
We encourage you to take this workflow and apply it to your own research questions about weather, risk, and society‚Äîthe more you explore, the more insights you‚Äôll uncover.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../tutorials/forum2-overview.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Forum 2 Overview</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#goals">Goals:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-this">Why do this?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-and-setup-imports">Introduction and Setup (Imports)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-search-for-datasets">Step 1: Search for Datasets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-search-for-10-results">Simple search for 10 results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-with-more-than-10-results">Search with more than 10 results</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subsetting-our-results">Subsetting Our Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-get-dataset-metadata-and-files">Step 2: Get Dataset Metadata and Files</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-metadata-for-a-single-dataset">Getting metadata for a single dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#file-level-metadata">File level metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-dataset-metadata">Full dataset metadata</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#transform-the-results-from-json">Transform the results from JSON</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-metadata-for-multiple-datasets">Getting metadata for multiple datasets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-download-a-file">Step 3: Download a File</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#examine-the-dataset">Examine the dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#variable-names">Variable names</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#unfortunately-nws-region-only-has-four-regions-nonetheless-it-might-be-useful-at-some-point">Unfortunately, ‚Äúnws_region‚Äù only has four regions.  Nonetheless, it might be useful at some point.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-merge-with-weather-data">Step 4: Merge with Weather Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#iowa-mesonet">Iowa Mesonet</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-visualizations-of-the-watches-and-warnings">Quick Visualizations of the Watches and Warnings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-wwwas-by-survey-reponses">Visualizing WWWAs by Survey Reponses</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#going-further">Going further</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chi-square">Chi-Square</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logistic-regression">Logistic Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ordinal-logistic-regression">Ordinal Logistic Regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#but-did-wwas-really-affect-risk-perception">But Did WWAs <em>Really</em> Affect Risk Perception?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-possible-interpretation">A possible interpretation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapping-up">Wrapping Up</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#moving-forward">Moving Forward</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>